{% extends "base.html" %}
{% block content %}
<div class="flex flex-col lg:flex-row gap-6">
    <!-- Left Column: Podcasts List -->
    <div class="flex-1 lg:w-2/3">
        <div class="space-y-4">
            {% for podcast in podcasts %}
            <a href="/podcast/{{ loop.index0 }}"
                class="block bg-slate-800 rounded-lg border border-slate-700 hover:border-slate-600 transition overflow-hidden cursor-pointer">
                <div class="p-4 flex items-start gap-4">
                    <!-- Podcast Image/Avatar -->
                    <div class="flex-shrink-0">
                        <img class="w-16 h-16 rounded-lg object-cover" src="{{ podcast.image_url }}"
                            alt="{{ podcast.title }}">
                    </div>

                    <!-- Podcast Info -->
                    <div class="flex-1 min-w-0">
                        <div class="flex items-start justify-between gap-4">
                            <div class="flex-1 min-w-0">
                                <h3 class="text-lg font-semibold text-white mb-1">{{ podcast.title }}</h3>
                                <p class="text-sm text-slate-400 line-clamp-2">{{ podcast.description }}</p>
                            </div>
                            <div class="flex items-center gap-2 flex-shrink-0">
                                <span
                                    class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold bg-green-500/20 text-green-400 border border-green-500/30">
                                    {{ podcast.episodes_count }} episodes
                                </span>
                                <button
                                    onclick="event.preventDefault(); event.stopPropagation(); openAddEpisodeModal('{{ podcast.title }}')"
                                    class="p-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition"
                                    title="Add Episode">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M12 4v16m8-8H4"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </a>
            {% endfor %}

            <!-- Add New Podcast Card -->
            <div
                class="bg-slate-800 rounded-lg border border-slate-700 hover:border-slate-600 transition overflow-hidden cursor-pointer">
                <div class="p-4 flex items-start gap-4">
                    <div class="flex-shrink-0">
                        <div class="w-16 h-16 rounded-lg bg-slate-700 flex items-center justify-center">
                            <svg class="w-8 h-8 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 4v16m8-8H4"></path>
                            </svg>
                        </div>
                    </div>
                    <div class="flex-1 min-w-0">
                        <h3 class="text-lg font-semibold text-white mb-1">Add new podcast</h3>
                        <p class="text-sm text-slate-400 line-clamp-2">You can add new podcast from here!</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Right Column: Stats and Timeline -->
    <div class="lg:w-1/3 space-y-6">
        <!-- Stats Widgets -->
        <div class="space-y-4">
            <!-- Total Episodes -->
            <div class="bg-slate-800 rounded-lg border border-slate-700 p-4">
                <div class="flex items-center gap-4">
                    <div class="flex-shrink-0 w-12 h-12 rounded-lg bg-purple-500/20 flex items-center justify-center">
                        <svg class="w-6 h-6 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3">
                            </path>
                        </svg>
                    </div>
                    <div class="flex-1 min-w-0">
                        <p class="text-sm text-slate-400">Total Episodes | Podcasts</p>
                        <p class="text-2xl font-semibold text-white">
                            {{ stats.total_episodes }}
                            | {{ stats.total_podcasts }}
                        </p>
                    </div>
                </div>
            </div>

            <!-- Total Episodes -->
{#            <div class="bg-slate-800 rounded-lg border border-slate-700 p-4">#}
{#                <div class="flex items-center gap-4">#}
{#                    <div class="flex-shrink-0 w-12 h-12 rounded-lg bg-blue-500/20 flex items-center justify-center">#}
{#                        <svg class="w-6 h-6 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">#}
{#                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"#}
{#                                d="M4 6h16M4 12h16M4 18h16"></path>#}
{#                        </svg>#}
{#                    </div>#}
{#                    <div class="flex-1 min-w-0">#}
{#                        <p class="text-sm text-slate-400">Total Episodes</p>#}
{#                        <p class="text-2xl font-semibold text-white">{{ stats.total_episodes }}</p>#}
{#                    </div>#}
{#                </div>#}
{#            </div>#}

            <!-- Recent Activity -->
{#            <div class="bg-slate-800 rounded-lg border border-slate-700 p-4">#}
{#                <div class="flex items-center gap-4">#}
{#                    <div class="flex-shrink-0 w-12 h-12 rounded-lg bg-green-500/20 flex items-center justify-center">#}
{#                        <svg class="w-6 h-6 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">#}
{#                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"#}
{#                                d="M13 10V3L4 14h7v7l9-11h-7z"></path>#}
{#                        </svg>#}
{#                    </div>#}
{#                    <div class="flex-1 min-w-0">#}
{#                        <p class="text-sm text-slate-400">Recent Activity</p>#}
{#                        <p class="text-sm font-medium text-white mt-1">{{ stats.recent_activity.text }}</p>#}
{#                        {% if stats.recent_activity.time %}#}
{#                        <p class="text-xs text-slate-500 mt-1">{{ stats.recent_activity.time }}</p>#}
{#                        {% endif %}#}
{#                    </div>#}
{#                </div>#}
{#            </div>#}

            <!-- Total Storage -->
            <div class="bg-slate-800 rounded-lg border border-slate-700 p-4">
                <div class="flex items-center gap-4">
                    <div class="flex-shrink-0 w-12 h-12 rounded-lg bg-orange-500/20 flex items-center justify-center">
                        <svg class="w-6 h-6 text-orange-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4">
                            </path>
                        </svg>
                    </div>
                    <div class="flex-1 min-w-0">
                        <p class="text-sm text-slate-400">Total Storage</p>
                        <p class="text-2xl font-semibold text-white">{{ stats.total_storage }}</p>
                    </div>
                </div>
            </div>
        <!-- Recent Episodes Timeline -->
        <div class="bg-slate-800 rounded-lg border border-slate-700">
            <div class="p-4 border-b border-slate-700">
                <h3 class="text-lg font-semibold text-white">Recent Episodes</h3>
            </div>
            <div class="divide-y divide-slate-700">
                {% if recent_episodes %}
                {% for episode in recent_episodes %}
                <div class="p-4 hover:bg-slate-700/50 transition cursor-pointer">
                    <div class="flex items-start gap-3">
                        <div
                            class="flex-shrink-0 w-10 h-10 rounded-full bg-slate-700 flex items-center justify-center text-lg">
                            {{ episode.icon }}
                        </div>
                        <div class="flex-1 min-w-0">
                            <p class="text-sm font-semibold text-white mb-1 line-clamp-2">{{ episode.title }}</p>
                            <p class="text-xs text-slate-400">
                                {% if episode.podcast %}
                                {{ episode.podcast }} â€¢
                                {% endif %}
                                2h ago
                            </p>
                        </div>
                        <div class="flex-shrink-0">
                            <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7">
                                </path>
                            </svg>
                        </div>
                    </div>
                </div>
                {% endfor %}
                {% else %}
                <div class="p-4 text-center">
                    <p class="text-sm text-slate-400">No episodes yet</p>
                </div>
                {% endif %}
            </div>
        </div>

        </div>

    </div>
</div>

<!-- Add Episode Modal -->
<div id="addEpisodeModal" class="fixed inset-0 bg-black/50 z-50 hidden items-center justify-center">
    <div class="bg-slate-800 rounded-lg border border-slate-700 w-full max-w-md mx-4 shadow-xl">
        <div class="p-6 border-b border-slate-700">
            <div class="flex items-center justify-between">
                <h3 class="text-lg font-semibold text-white">Add New Episode</h3>
                <button onclick="closeAddEpisodeModal()" class="text-slate-400 hover:text-white transition">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                        </path>
                    </svg>
                </button>
            </div>
        </div>
        <form class="p-6 space-y-4" onsubmit="handleAddEpisode(event)">
            <div>
                <label for="episodePodcast" class="block text-sm font-medium text-slate-300 mb-2">Podcast</label>
                <select id="episodePodcast" name="podcast"
                    class="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-purple-500">
                    {% for podcast in podcasts %}
                    <option value="{{ podcast.title }}">{{ podcast.title }}</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label for="episodeTitle" class="block text-sm font-medium text-slate-300 mb-2">Episode Title</label>
                <input type="text" id="episodeTitle" name="title" required
                    class="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-purple-500"
                    placeholder="Enter episode title">
            </div>
            <div>
                <label for="episodeDescription" class="block text-sm font-medium text-slate-300 mb-2">Description
                    (optional)</label>
                <textarea id="episodeDescription" name="description" rows="3"
                    class="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-purple-500"
                    placeholder="Enter episode description"></textarea>
            </div>
            <div>
                <label for="episodeDate" class="block text-sm font-medium text-slate-300 mb-2">Publication Date</label>
                <input type="date" id="episodeDate" name="date" required
                    class="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-purple-500">
            </div>
            <div class="flex items-center justify-end gap-3 pt-4 border-t border-slate-700">
                <button type="button" onclick="closeAddEpisodeModal()"
                    class="px-4 py-2 text-slate-300 hover:text-white transition">
                    Cancel
                </button>
                <button type="submit"
                    class="px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition font-medium">
                    Add Episode
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    function openAddEpisodeModal(podcastTitle) {
        const modal = document.getElementById('addEpisodeModal');
        const select = document.getElementById('episodePodcast');

        // Set selected podcast if provided
        if (podcastTitle && select) {
            for (let option of select.options) {
                if (option.value === podcastTitle) {
                    option.selected = true;
                    break;
                }
            }
        }

        modal.classList.remove('hidden');
        modal.classList.add('flex');
        document.body.style.overflow = 'hidden';
    }

    function closeAddEpisodeModal() {
        const modal = document.getElementById('addEpisodeModal');
        modal.classList.add('hidden');
        modal.classList.remove('flex');
        document.body.style.overflow = '';

        // Reset form
        const form = modal.querySelector('form');
        if (form) {
            form.reset();
        }
    }

    function handleAddEpisode(event) {
        event.preventDefault();
        // TODO: Implement actual API call to add episode
        console.log('Adding episode:', new FormData(event.target));
        alert('Episode will be added (API integration needed)');
        closeAddEpisodeModal();
    }

    // Close modal on Escape key
    document.addEventListener('keydown', function (event) {
        if (event.key === 'Escape') {
            closeAddEpisodeModal();
        }
    });

    // Close modal on background click
    document.getElementById('addEpisodeModal').addEventListener('click', function (event) {
        if (event.target === this) {
            closeAddEpisodeModal();
        }
    });
</script>
{% endblock %}
