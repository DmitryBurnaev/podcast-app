{% extends "base.html" %}

{% block body %}
<div class="flex h-screen overflow-hidden">
    <!-- Left Sidebar -->
    <aside class="w-64 bg-slate-800 flex flex-col h-full border-r border-slate-700">
        <!-- Logo -->
        <div class="p-6 flex items-center gap-3">
            <div
                class="w-8 h-8 rounded-lg bg-gradient-to-br from-purple-500 to-purple-600 flex items-center justify-center">
                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3">
                    </path>
                </svg>
            </div>
            <h1 class="text-xl font-bold text-white">Podcasts</h1>
        </div>

        <!-- Navigation -->
        <nav class="flex flex-col px-3 gap-1 flex-1">
            {% for link in navigation %}
            <a href="{{ link.path }}"
                class="px-3 py-2 rounded-lg {% if link.slug == current %} bg-slate-700 text-white {% else %} text-slate-300 hover:bg-slate-700 hover:text-white {% endif %} transition flex items-center gap-3">
                {% if link.slug == 'home' %}
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6">
                    </path>
                </svg>
                {% elif link.slug == 'episodes' %}
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 18v-6a9 9 0 0 1 18 0v6">
                    </path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z">
                    </path>
                </svg>
                {% elif link.slug == 'podcasts' %}
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16">
                    </path>
                </svg>
                {% elif link.slug == 'profile' %}
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                </svg>
                {% elif link.slug == 'about' %}
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                {% endif %}
                <span class="text-sm font-medium">{{ link.title }}</span>
            </a>
            {% endfor %}
        </nav>

        <!-- Settings -->
        <div class="border-t border-slate-700 px-3 py-4">
            <a href="#"
                class="px-3 py-2 rounded-lg text-slate-300 hover:bg-slate-700 hover:text-white transition flex items-center gap-3">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z">
                    </path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                </svg>
                <span class="text-sm font-medium">Settings</span>
            </a>
        </div>
    </aside>

    <!-- Main Content Area -->
    <div class="flex flex-col flex-1 overflow-hidden">
        <!-- Top Navigation Bar -->
        <header class="bg-slate-800 border-b border-slate-700 px-6 py-4 flex items-center justify-between">
            <!-- Search with Filter Icon -->
            <div class="flex-1 max-w-lg">
                <div class="relative">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <svg class="h-5 w-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                    </div>
                    <input type="text" id="search-input" placeholder="Search" value="{{ filters.search or '' }}"
                        class="block w-full pl-10 pr-10 py-2 border border-slate-600 rounded-lg bg-slate-700 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                    <button onclick="openFiltersModal()" class="absolute inset-y-0 right-0 pr-3 flex items-center">
                        <svg class="h-5 w-5 {% if filters %}text-purple-400{% else %}text-slate-400{% endif %}"
                            fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z">
                            </path>
                        </svg>
                        {% if filters %}
                        <span class="absolute top-0 right-0 w-2 h-2 bg-purple-500 rounded-full"></span>
                        {% endif %}
                    </button>
                </div>
            </div>

            <!-- Right side: Notifications, User -->
            <div class="flex items-center gap-4 ml-6">
                <button class="p-2 text-slate-300 hover:text-white hover:bg-slate-700 rounded-lg transition">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9">
                        </path>
                    </svg>
                </button>
                <div class="h-6 w-px bg-slate-600"></div>
                <div class="relative" id="user-dropdown">
                    <button id="user-dropdown-button"
                        class="flex items-center gap-3 text-slate-300 hover:text-white transition">
                        <div
                            class="w-8 h-8 rounded-full bg-slate-600 border-2 border-slate-500 flex items-center justify-center">
                            <span class="text-sm font-medium text-slate-300">{{ user_data.name[0] if user_data and
                                user_data.name else 'U' }}</span>
                        </div>
                        <span class="text-sm font-medium">{{ user_data.name if user_data and user_data.name else 'User'
                            }}</span>
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7">
                            </path>
                        </svg>
                    </button>
                    <div id="user-dropdown-menu"
                        class="absolute right-0 mt-2 w-48 bg-slate-700 rounded-lg shadow-lg border border-slate-600 z-50 hidden">
                        <div class="py-1">
                            <a href="/profile"
                                class="block px-4 py-2 text-sm text-slate-300 hover:bg-slate-600 hover:text-white transition">Your
                                profile</a>
                            <a href="#"
                                class="block px-4 py-2 text-sm text-slate-300 hover:bg-slate-600 hover:text-white transition">Sign
                                out</a>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="flex-1 overflow-y-auto bg-slate-900 pattern-bg">
            <div class="p-6">
                {% block content %}
                <!-- Active Filters -->
                {% if filters %}
                <div class="mb-4 flex items-center gap-2 flex-wrap">
                    <span class="text-sm text-slate-400">Active filters:</span>
                    {% if filters.search %}
                    <span
                        class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-slate-700 text-slate-300">
                        Search: {{ filters.search }}
                        <button onclick="removeFilter('search')" class="ml-2 hover:text-white">×</button>
                    </span>
                    {% endif %}
                    {% if filters.status %}
                    <span
                        class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-slate-700 text-slate-300">
                        Status: {{ filters.status }}
                        <button onclick="removeFilter('status')" class="ml-2 hover:text-white">×</button>
                    </span>
                    {% endif %}
                    {% if filters.size_min or filters.size_max %}
                    <span
                        class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-slate-700 text-slate-300">
                        Size: {% if filters.size_min %}{{ filters.size_min }}{% endif %}-{% if filters.size_max %}{{
                        filters.size_max }}{% endif %} MB
                        <button onclick="removeFilter('size_min'); removeFilter('size_max')"
                            class="ml-2 hover:text-white">×</button>
                    </span>
                    {% endif %}
                    {% if filters.podcast %}
                    <span
                        class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-slate-700 text-slate-300">
                        Podcast: {{ filters.podcast }}
                        <button onclick="removeFilter('podcast')" class="ml-2 hover:text-white">×</button>
                    </span>
                    {% endif %}
                    <button onclick="clearAllFilters()" class="text-xs text-slate-400 hover:text-white underline">Clear
                        all</button>
                </div>
                {% endif %}

                <!-- Episodes List -->
                <div class="space-y-4">
                    {% if episodes %}
                    {% for episode in episodes %}
                    <a href="/episode/{{ loop.index0 }}"
                        class="block bg-slate-800 rounded-lg border border-slate-700 hover:border-slate-600 transition overflow-hidden cursor-pointer">
                        <div class="p-4 flex items-start gap-4">
                            <!-- Episode Image/Icon -->
                            <div class="flex-shrink-0">
                                {% if episode.thumbnail_url %}
                                <img class="w-16 h-16 rounded-lg object-cover" src="{{ episode.thumbnail_url }}"
                                    alt="{{ episode.title }}">
                                {% else %}
                                <div class="w-16 h-16 rounded-lg bg-slate-700 flex items-center justify-center">
                                    <span class="text-2xl">{{ episode.icon }}</span>
                                </div>
                                {% endif %}
                            </div>

                            <!-- Episode Info -->
                            <div class="flex-1 min-w-0">
                                <div class="flex items-start justify-between gap-4 mb-2">
                                    <div class="flex-1 min-w-0">
                                        <h3 class="text-lg font-semibold text-white mb-1">
                                            {% if episode.icon %}<span class="mr-2">{{ episode.icon }}</span>{% endif
                                            %}{{ episode.title }}
                                        </h3>
                                        {% if episode.description %}
                                        <p class="text-sm text-slate-400 line-clamp-2 mb-2">{{ episode.description }}
                                        </p>
                                        {% endif %}

                                        <!-- Additional Info -->
                                        <div class="flex items-center gap-4 flex-wrap text-xs text-slate-500">
                                            {% if episode.duration %}
                                            <div class="flex items-center gap-1">
                                                <svg class="w-4 h-4" fill="none" stroke="currentColor"
                                                    viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2"
                                                        d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                                </svg>
                                                <span>{{ format_duration(episode.duration) }}</span>
                                            </div>
                                            {% endif %}
                                            {% if episode.file_size %}
                                            <div class="flex items-center gap-1">
                                                <svg class="w-4 h-4" fill="none" stroke="currentColor"
                                                    viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2"
                                                        d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4">
                                                    </path>
                                                </svg>
                                                <span>{{ format_file_size(episode.file_size) }}</span>
                                            </div>
                                            {% endif %}
                                            {% if episode.publication_date or episode.download_date %}
                                            <div class="flex items-center gap-3">
                                                {% if episode.publication_date %}
                                                <div class="flex items-center gap-1" title="Publication date">
                                                    <svg class="w-4 h-4" fill="none" stroke="currentColor"
                                                        viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round"
                                                            stroke-width="2"
                                                            d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z">
                                                        </path>
                                                    </svg>
                                                    <span>{{ episode.publication_date }}</span>
                                                </div>
                                                {% endif %}
                                                {% if episode.download_date %}
                                                <div class="flex items-center gap-1" title="Download date">
                                                    <svg class="w-4 h-4" fill="none" stroke="currentColor"
                                                        viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round"
                                                            stroke-width="2"
                                                            d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4">
                                                        </path>
                                                    </svg>
                                                    <span>{{ episode.download_date }}</span>
                                                </div>
                                                {% endif %}
                                            </div>
                                            {% endif %}
                                        </div>
                                    </div>

                                    <!-- Right Side: Status and Controls -->
                                    <div class="flex flex-col items-end gap-3 flex-shrink-0">
                                        <!-- Status Badge -->
                                        {% set status_colors = get_episode_status_color(episode.status) %}
                                        <div class="flex flex-col items-end gap-2">
                                            {% if episode.status == "downloading" and episode.download_progress is
                                            defined %}
                                            <span
                                                class="relative inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold text-blue-400 border border-blue-500/30 overflow-hidden">
                                                <span class="absolute inset-0 bg-blue-500/20"></span>
                                                <span class="absolute inset-0 bg-blue-500/40 transition-all"
                                                    style="width: {{ episode.download_progress }}%"></span>
                                                <span class="relative z-10">{{ get_episode_status_label(episode.status)
                                                    }} {{ episode.download_progress }}%</span>
                                            </span>
                                            {% else %}
                                            <span
                                                class="inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold {{ status_colors.bg }} {{ status_colors.text }} border {{ status_colors.border }}">
                                                {{ get_episode_status_label(episode.status) }}
                                            </span>
                                            {% endif %}
                                        </div>

                                        <!-- Control Buttons -->
                                        <div class="flex items-center gap-2">
                                            {% if episode.status == "pending" or episode.status == "error" %}
                                            <button
                                                onclick="event.preventDefault(); event.stopPropagation(); handleDownload({{ loop.index0 }})"
                                                class="p-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition"
                                                title="Download">
                                                <svg class="w-4 h-4" fill="none" stroke="currentColor"
                                                    viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2"
                                                        d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4">
                                                    </path>
                                                </svg>
                                            </button>
                                            {% endif %}
                                            <button
                                                onclick="event.preventDefault(); event.stopPropagation(); handleUpdate({{ loop.index0 }})"
                                                class="p-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition"
                                                title="Update">
                                                <svg class="w-4 h-4" fill="none" stroke="currentColor"
                                                    viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2"
                                                        d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15">
                                                    </path>
                                                </svg>
                                            </button>
                                            <button
                                                onclick="event.preventDefault(); event.stopPropagation(); handleDelete({{ loop.index0 }})"
                                                class="p-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition"
                                                title="Delete">
                                                <svg class="w-4 h-4" fill="none" stroke="currentColor"
                                                    viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2"
                                                        d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16">
                                                    </path>
                                                </svg>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </a>
                    {% endfor %}
                    {% else %}
                    <div class="bg-slate-800 rounded-lg border border-slate-700 p-8 text-center">
                        <p class="text-slate-400">No episodes available</p>
                    </div>
                    {% endif %}
                </div>
                {% endblock %}
            </div>
        </main>
    </div>
</div>

<!-- Filters Modal -->
<div id="filtersModal" class="fixed inset-0 bg-black/50 z-50 hidden items-center justify-center">
    <div class="bg-slate-800 rounded-lg border border-slate-700 w-full max-w-md mx-4 shadow-xl">
        <div class="p-6 border-b border-slate-700">
            <div class="flex items-center justify-between">
                <h3 class="text-lg font-semibold text-white">Filters</h3>
                <button onclick="closeFiltersModal()" class="text-slate-400 hover:text-white transition">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                        </path>
                    </svg>
                </button>
            </div>
        </div>
        <form class="p-6 space-y-4" onsubmit="applyFilters(event)">
            <!-- Search -->
            <div>
                <label for="filterSearch" class="block text-sm font-medium text-slate-300 mb-2">Search</label>
                <input type="text" id="filterSearch" name="search" value="{{ filters.search or '' }}"
                    class="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-purple-500"
                    placeholder="Search episodes...">
            </div>

            <!-- Status -->
            <div>
                <label class="block text-sm font-medium text-slate-300 mb-2">Status</label>
                <div class="space-y-2">
                    {% if filters.status %}
                    {% set status_list = filters.status.split(',') %}
                    {% else %}
                    {% set status_list = [] %}
                    {% endif %}
                    <label class="flex items-center gap-2 text-slate-300">
                        <input type="checkbox" name="status" value="published" {% if 'published' in status_list
                            %}checked{% endif %}
                            class="rounded bg-slate-700 border-slate-600 text-purple-600 focus:ring-purple-500">
                        <span>Published</span>
                    </label>
                    <label class="flex items-center gap-2 text-slate-300">
                        <input type="checkbox" name="status" value="downloading" {% if 'downloading' in status_list
                            %}checked{% endif %}
                            class="rounded bg-slate-700 border-slate-600 text-purple-600 focus:ring-purple-500">
                        <span>Downloading</span>
                    </label>
                    <label class="flex items-center gap-2 text-slate-300">
                        <input type="checkbox" name="status" value="error" {% if 'error' in status_list %}checked{%
                            endif %}
                            class="rounded bg-slate-700 border-slate-600 text-purple-600 focus:ring-purple-500">
                        <span>Error</span>
                    </label>
                    <label class="flex items-center gap-2 text-slate-300">
                        <input type="checkbox" name="status" value="pending" {% if 'pending' in status_list %}checked{%
                            endif %}
                            class="rounded bg-slate-700 border-slate-600 text-purple-600 focus:ring-purple-500">
                        <span>Pending</span>
                    </label>
                </div>
            </div>

            <!-- File Size Range -->
            <div>
                <label class="block text-sm font-medium text-slate-300 mb-2">File Size (MB)</label>
                <div class="flex items-center gap-2">
                    <input type="number" id="sizeMin" name="size_min" value="{{ filters.size_min or '' }}" step="0.1"
                        min="0"
                        class="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-purple-500"
                        placeholder="Min">
                    <span class="text-slate-400">-</span>
                    <input type="number" id="sizeMax" name="size_max" value="{{ filters.size_max or '' }}" step="0.1"
                        min="0"
                        class="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-purple-500"
                        placeholder="Max">
                </div>
            </div>

            <!-- Podcast -->
            <div>
                <label for="filterPodcast" class="block text-sm font-medium text-slate-300 mb-2">Podcast</label>
                <select id="filterPodcast" name="podcast"
                    class="w-full px-3 py-2 bg-slate-700 border border-slate-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-purple-500">
                    <option value="">All Podcasts</option>
                    {% for podcast in podcasts %}
                    <option value="{{ podcast.title }}" {% if filters.podcast==podcast.title %}selected{% endif %}>{{
                        podcast.title }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="flex items-center justify-end gap-3 pt-4 border-t border-slate-700">
                <button type="button" onclick="clearAllFilters()"
                    class="px-4 py-2 text-slate-300 hover:text-white transition">
                    Clear All
                </button>
                <button type="submit"
                    class="px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition font-medium">
                    Apply Filters
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    // Search functionality
    document.getElementById('search-input').addEventListener('keypress', function (e) {
        if (e.key === 'Enter') {
            e.preventDefault();
            applySearch();
        }
    });

    function applySearch() {
        const searchValue = document.getElementById('search-input').value;
        const url = new URL(window.location.href);
        if (searchValue) {
            url.searchParams.set('search', searchValue);
        } else {
            url.searchParams.delete('search');
        }
        window.location.href = url.toString();
    }

    // Filters modal
    function openFiltersModal() {
        const modal = document.getElementById('filtersModal');
        modal.classList.remove('hidden');
        modal.classList.add('flex');
        document.body.style.overflow = 'hidden';
    }

    function closeFiltersModal() {
        const modal = document.getElementById('filtersModal');
        modal.classList.add('hidden');
        modal.classList.remove('flex');
        document.body.style.overflow = '';
    }

    function applyFilters(event) {
        event.preventDefault();
        const formData = new FormData(event.target);
        const url = new URL(window.location.href);
        url.search = '';

        // Search
        const search = formData.get('search');
        if (search) {
            url.searchParams.set('search', search);
        }

        // Status
        const statuses = formData.getAll('status');
        if (statuses.length > 0) {
            url.searchParams.set('status', statuses.join(','));
        }

        // Size
        const sizeMin = formData.get('size_min');
        const sizeMax = formData.get('size_max');
        if (sizeMin) {
            url.searchParams.set('size_min', sizeMin);
        }
        if (sizeMax) {
            url.searchParams.set('size_max', sizeMax);
        }

        // Podcast
        const podcast = formData.get('podcast');
        if (podcast) {
            url.searchParams.set('podcast', podcast);
        }

        window.location.href = url.toString();
    }

    function removeFilter(filterName) {
        const url = new URL(window.location.href);
        if (filterName === 'size_min' || filterName === 'size_max') {
            url.searchParams.delete('size_min');
            url.searchParams.delete('size_max');
        } else {
            url.searchParams.delete(filterName);
        }
        window.location.href = url.toString();
    }

    function clearAllFilters() {
        window.location.href = '/episodes';
    }

    // Close modal on Escape key
    document.addEventListener('keydown', function (event) {
        if (event.key === 'Escape') {
            closeFiltersModal();
        }
    });

    // Close modal on background click
    document.getElementById('filtersModal').addEventListener('click', function (event) {
        if (event.target === this) {
            closeFiltersModal();
        }
    });

    // Dropdown menu functionality
    (function () {
        const dropdownButton = document.getElementById('user-dropdown-button');
        const dropdownMenu = document.getElementById('user-dropdown-menu');
        const dropdownContainer = document.getElementById('user-dropdown');

        if (dropdownButton && dropdownMenu) {
            dropdownButton.addEventListener('click', function (e) {
                e.stopPropagation();
                dropdownMenu.classList.toggle('hidden');
            });

            document.addEventListener('click', function (e) {
                if (!dropdownContainer.contains(e.target)) {
                    dropdownMenu.classList.add('hidden');
                }
            });

            dropdownMenu.addEventListener('click', function (e) {
                if (e.target.tagName === 'A') {
                    dropdownMenu.classList.add('hidden');
                }
            });
        }
    })();

    function handleDownload(episodeId) {
        console.log('Download episode:', episodeId);
        alert('Download functionality will be implemented');
    }

    function handleUpdate(episodeId) {
        console.log('Update episode:', episodeId);
        alert('Update functionality will be implemented');
    }

    function handleDelete(episodeId) {
        if (confirm('Are you sure you want to delete this episode?')) {
            console.log('Delete episode:', episodeId);
            alert('Delete functionality will be implemented');
        }
    }
</script>
{% endblock %}